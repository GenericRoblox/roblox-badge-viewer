<script>
  async function fetchBadges() {
    const userId = document.getElementById('userid').value.trim();
    const list = document.getElementById('badgeLinks');
    list.innerHTML = '';

    if (!userId || isNaN(userId)) {
      list.innerHTML = '<li>Please enter a valid numeric user ID.</li>';
      return;
    }

    try {
      const res = await fetch(`/api/badges?userId=${userId}`);
      if (!res.ok) throw new Error('Failed to fetch from backend');

      const badgeJson = await res.json();
      const badges = badgeJson.data;

      if (!badges || badges.length === 0) {
        list.innerHTML = '<li>No badges found for this user.</li>';
        return;
      }

      for (const badge of badges) {
        const placeId = badge.awarder?.id;
        if (!placeId) continue;

        // Step 1: Get universeId from placeId
        const universeRes = await fetch(`https://apis.roblox.com/universes/v1/places/${placeId}/universe`);
        if (!universeRes.ok) continue;
        const universeData = await universeRes.json();
        const universeId = universeData.universeId;

        // Step 2: Get game info from universeId
        const gameRes = await fetch(`https://games.roblox.com/v1/games?universeIds=${universeId}`);
        if (!gameRes.ok) continue;
        const gameData = await gameRes.json();
        const gameName = gameData.data[0]?.name || 'Unknown Game';

        // Link to the game page
        const gameLink = `https://www.roblox.com/games/${placeId}`;
        const li = document.createElement('li');
        li.innerHTML = `<a href="${gameLink}" target="_blank">${gameName}</a>`;
        list.appendChild(li);
      }

    } catch (err) {
      console.error('Error:', err);
      list.innerHTML = '<li>Error fetching badge or game data.</li>';
    }
  }
</script>
